# Exploiting path mapping for web cache deception
# Objective
To solve the lab, find the API key for the user carlos. You can log in to your own account using the following credentials: `wiener:peter`. 


# Solution
## Analysis
Request to `/my-account` returns information about logged user with his API key.

|![](Images/image.png)|
|:--:| 
| *User profile page* |
|![](Images/image-1.png)|
| *Adding data to path does not result in error* |
|![](Images/image-2.png)|
| *Adding files (js/css/png/...) to path does not result in error* |
|![](Images/image-3.png)|
| *Responses with extra data in path are cached and can be accessed by everyone* |

## Exploitation
Reques with extra data after in path after `/my-account` are cached and can be accessed by everyone. URL is not mapped to to a resource located on the file system (`Traditional mapping`), instead it is mapped to abstract file paths that are converted into logical parts of the API (`REST-style`).

|![](Images/image-4.png)|
|:--:| 
| *First request - Cache miss* |
|![](Images/image-5.png)|
| *Second request - Cache hit* |
|![](Images/image-6.png)|
| *Third request without session cookie - Cache hit* |
|![](Images/image-7.png)|
| *Third request without session cookie - Cache hit* |


Final payload:
```js
<script>document.location="https://0aac00ef04b1e03d8011589e0032006f.web-security-academy.net/my-account/carlosapikey.js"</script>
```

|![](Images/image-8.png)|
|:--:| 
| *Retrieving Carlos API key from cached response* |
