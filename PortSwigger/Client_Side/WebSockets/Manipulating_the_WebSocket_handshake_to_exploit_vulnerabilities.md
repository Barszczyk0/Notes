# Manipulating the WebSocket handshake to exploit vulnerabilities
# Objective
This online shop has a live chat feature implemented using WebSockets.

It has an aggressive but flawed XSS filter.

To solve the lab, use a WebSocket message to trigger an `alert()` popup in the support agent's browser.

# Solution
## Analysis
On the website there is a live chat feature implemented using WebSockets. 
|![](Images/image-4.png)|
|:--:| 
| *WebSocket handshake* |

## Exploitation
Basic XSS attack attempts are detected. After attempt attacker IP in blacklisted.

|![](Images/image-5.png)|
|:--:| 
| *Failed XSS attack attempt* |
|![](Images/image-6.png)|
| *Attacker IP address is blacklisted* |

Blacklist can be bypassed using `X-Forwarded-For` header.
|![](Images/image-7.png)|
|:--:| 
| *Blacklist bypass* |
|![](Images/image-8.png)|
| *Result - chat works again* |

Using the following payload it is possible to bypass XSS filter:
```json
{"message":"<img src=0 oNeRrOr=alert`0`>"}
```
|![](Images/image-9.png)|
|:--:| 
| *Successful XSS payload* |